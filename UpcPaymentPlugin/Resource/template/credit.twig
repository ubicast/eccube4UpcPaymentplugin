{#
    Shopping/index.twigに以下のスニペットを追記
    {{ include('@UpcPaymentPlugin/credit.twig', ignore_missing=true) }}
#}
{% if Order.Payment.getMethodClass == 'Plugin\\UpcPaymentPlugin\\Service\\Method\\CreditCard' %}
<script src="https://token.ccps.jp/UpcTokenPaymentMini.js"></script>
    <script>
        $(function () {
            $('#shopping-form > div > div.ec-orderRole__summary > div > div.ec-totalBox__btn > button').on('click', function (e) {
                // トークン取得処理
                var card_no = $('#shopping_order_upc_payment_card_no').val();

                if (card_no == '') {
                    alert('カード番号が入力されていません');
                    return false;
                }

                // サーバ通信してトークンを取得
                upcgettoken();
            });
        });
  function upcPaymentToken(response) {
    console.log(response);
    // hiddenにトークンをセット
    document.getElementById('shopping_order_upc_payment_plugin_token').value = response.tokenObject.token;
    document.getElementById('shopping-form').submit;
  }
function upcgettoken(){
  Multipayment.init('103842');
  Multipayment.getMember({　
      cardno: '4444333322221111',
      securitycode: '123',
      expire: '1225',
      holderfirstname: 'fn',
      holderlastname: 'ln'
    },
    upcPaymentToken);
}


    </script>
    <div class="ec-orderPayment">
        <div class="ec-rectHeading">
            <h2>クレジットカード</h2>
        </div>
        <div class="ec-input">
            {# jsで取得したトークンをhiddenでサーバサイドへsubmitする. #}
            {{ form_widget(form.upc_payment_plugin_token) }}

            {# カード番号をサーバサイドへPOSTしないよう, name属性は出力しない #}
            <input type="text" id="shopping_order_upc_payment_card_no">
        </div>
    </div>
{% else %}
    {{ form_widget(form.upc_payment_plugin_token, { type: 'hidden' }) }}
{% endif %}
